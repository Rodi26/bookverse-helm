# BookVerse GKE Ingress with Global Static IP
# This is a standalone ingress configuration for GKE
# Based on the working Artifactory example provided

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: bookverse-web-ingress
  namespace: bookverse-prod
  annotations:
    # GKE Ingress annotations (similar to Artifactory example)
    kubernetes.io/ingress.class: gce
    kubernetes.io/ingress.global-static-ip-name: bookverse-web-ip
    
    # Proxy configuration for large payloads and long connections
    ingress.kubernetes.io/proxy-body-size: "0"
    ingress.kubernetes.io/proxy-read-timeout: "600"
    ingress.kubernetes.io/proxy-send-timeout: "600"
    
    # Google-managed certificate
    networking.gke.io/managed-certificates: bookverse-web-cert-prod
  
  labels:
    app: bookverse
    environment: prod
    component: web
    traffic-type: external

spec:
  ingressClassName: gce
  
  # TLS configuration
  tls:
    - hosts:
        - bookverse.rodolphef.org
      secretName: bookverse-web-tls
  
  # Routing rules
  rules:
    - host: bookverse.rodolphef.org
      http:
        paths:
          # Inventory API
          - path: /api/v1/books
            pathType: Prefix
            backend:
              service:
                name: inventory
                port:
                  number: 80
          
          # Static assets from inventory
          - path: /static
            pathType: Prefix
            backend:
              service:
                name: inventory
                port:
                  number: 80
          
          # Recommendations service
          - path: /recommendations
            pathType: Prefix
            backend:
              service:
                name: recommendations
                port:
                  number: 80
          
          # Checkout service
          - path: /checkout
            pathType: Prefix
            backend:
              service:
                name: checkout
                port:
                  number: 80
          
          # Web frontend (default route)
          - path: /
            pathType: Prefix
            backend:
              service:
                name: platform-web
                port:
                  number: 80

---
# Additional Ingress for other environments (staging, qa, dev)
# Uncomment and customize as needed

# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: bookverse-web-ingress
#   namespace: bookverse-staging
#   annotations:
#     kubernetes.io/ingress.class: gce
#     kubernetes.io/ingress.global-static-ip-name: bookverse-web-staging-ip
#     ingress.kubernetes.io/proxy-body-size: "0"
#     ingress.kubernetes.io/proxy-read-timeout: "600"
#     ingress.kubernetes.io/proxy-send-timeout: "600"
#     networking.gke.io/managed-certificates: bookverse-web-cert-staging
#   labels:
#     app: bookverse
#     environment: staging
# spec:
#   ingressClassName: gce
#   tls:
#     - hosts:
#         - bookverse-staging.rodolphef.org
#       secretName: bookverse-web-staging-tls
#   rules:
#     - host: bookverse-staging.rodolphef.org
#       http:
#         paths:
#           - path: /
#             pathType: Prefix
#             backend:
#               service:
#                 name: platform-web
#                 port:
#                   number: 80

